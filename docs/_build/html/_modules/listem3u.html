<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>listem3u &mdash; Documentation listem3u V1.0b</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/listem3u.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            listem3u
              <img src="../_static/listem3u.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1-sans-fichier-mp3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">listem3u</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">listem3u</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Code du module</a></li>
      <li class="breadcrumb-item active">listem3u</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Code source de listem3u</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- encoding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot; </span>
<span class="sd">  Created on 25 mars 2023</span>

<span class="sd">  @author: Nicolas Bruschi</span>

<span class="sd">  Exploite fichiers extension m3u dans les sous-répertoires du repertoire de</span>
<span class="sd">  travail, pour constituer la liste des fichiers mp3 classés.</span>

<span class="sd">  [EN ENTREE]</span>
<span class="sd">    [-h |--help : Demande usage] Optionnel</span>
<span class="sd">    [-m |--mp3 : Verification existence fic mp3] Optionnel. Defaut = False</span>
<span class="sd">    [-r |--repertoire] &lt;repertoire de travail&gt;  Optionnel</span>
<span class="sd">                                                defaut = Repertoire_travail</span>
<span class="sd">    [-v |--version : Demande version] Optionnel</span>
<span class="sd">    Tous les parametres acceptent casse minuscules/majuscules</span>

<span class="sd">  [EN SORTIE]</span>
<span class="sd">    0 OK # Constitution dans le repertoire de travail du fichier de sortie</span>
<span class="sd">    1 KO</span>

<span class="sd">  [VERSIONS]</span>
<span class="sd">    [2023-03-25] BN V1.0 :  Initialisation</span>
<span class="sd">    [2023-03-26] BN V1.1 :  Filtre les fichiers mp3 listés. Pylint.</span>
<span class="sd">                            Tests unitaires</span>
<span class="sd">    [2023-03-28] BN V1.2 :  Debug repertoire travail PureWindowsPath</span>
<span class="sd">    [2023-03-29] BN V1.3 :  issue 1-listemp3upy-sans-fichier-mp3</span>

<span class="sd">  [REFERENCES]</span>
<span class="sd">    https://www.githubstatus.com/</span>
<span class="sd">    https://www.sphinx-doc.org/fr/master/index.html</span>
<span class="sd">    https://github.com/maltfield/rtd-github-pages/</span>
<span class="sd">    https://docs.github.com/en/actions/monitoring-and-troubleshooting-workflows/</span>
<span class="sd">    adding-a-workflow-status-badge</span>
<span class="sd">    https://github.com/marketplace/actions/github-pages-action</span>
<span class="sd">    https://github.com/marketplace/actions/sphinx-docs-to-github-pages</span>
<span class="sd">    # pour memo : python3 -m http.server</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">## Bibliotheques ##</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">getopt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">exists</span> <span class="k">as</span> <span class="n">file_exists</span>

<span class="c1">## Variables Globales ##</span>

<span class="n">FILENAME</span> <span class="o">=</span> <span class="s2">&quot;listem3u.py&quot;</span>
<span class="n">VERSION</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">FILENAME</span><span class="si">}</span><span class="s2"> version : [2023-03-29 BN V1.3]&quot;</span>
<span class="n">REP_TRAV</span> <span class="o">=</span> <span class="s2">&quot;P:</span><span class="se">\\</span><span class="s2">Morceaux_choisis&quot;</span>
<span class="n">USAGE</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  usage: </span><span class="si">{</span><span class="n">FILENAME</span><span class="si">}</span><span class="s2"> [OPTIONS]</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="s2">&quot;  OPTIONS:</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="s2">&quot;  [-h |--help : Demande usage] Optionnel</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="s2">&quot;  [-m |--mp3 : Verification existence fic mp3] Optionnel. Defaut = False</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="s2">&quot;  [-r |--repertoire] &lt;repertoire de travail&gt; Optionnel</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="sa">f</span><span class="s2">&quot;                                             defaut = </span><span class="si">{</span><span class="n">REP_TRAV</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="s2">&quot;  [-v |--version : Demande version] Optionnel</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="s2">&quot;  Tous les parametres acceptent casse minuscules/majuscules.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">FICS_LISTE_TAMPON</span> <span class="o">=</span> <span class="s2">&quot;liste.m3u&quot;</span>
<span class="n">NOW</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">FICS_LISTE</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;liste-</span><span class="si">{</span><span class="n">NOW</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%Y&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.m3u&quot;</span>
<span class="n">DEFAUT_FICMP3</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1">## Fonctions :</span>
<span class="c1">##############</span>

<div class="viewcode-block" id="parametres"><a class="viewcode-back" href="../listem3u.html#listem3u.parametres">[docs]</a><span class="k">def</span> <span class="nf">parametres</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot; Gestion des parametres d&#39;appel = repertoire, help et version</span>

<span class="sd">  [ EN ENTREE ]</span>
<span class="sd">    argv = Les parametres d&#39;appel du script</span>

<span class="sd">  [ EN SORTIE ]</span>
<span class="sd">    codeexit (entier) 0, 1 ou 2</span>
<span class="sd">    scom (chaine) commentaire</span>
<span class="sd">    repertoire_travail (chaine)</span>
<span class="sd">    test_presenceficmp3 (boolean)</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1">### parametre local</span>
  <span class="n">codeexit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">repertoire_travail</span> <span class="o">=</span> <span class="n">REP_TRAV</span>  <span class="c1"># valeur defaut</span>
  <span class="n">oncontinue</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># si demande aide = 1 ou version = 10 ou les 2 = 11</span>
  <span class="n">scom</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># commentaire si parametre imprevu</span>
  <span class="n">test_presenceficmp3</span> <span class="o">=</span> <span class="n">DEFAUT_FICMP3</span> <span class="c1"># val defaut</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="c1"># pylint: disable=unused-variable</span>
    <span class="n">options</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s2">&quot;hHmMvVr:R:&quot;</span><span class="p">,</span>
                                        <span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">,</span> <span class="s2">&quot;HELP&quot;</span><span class="p">,</span> <span class="s2">&quot;mp3&quot;</span><span class="p">,</span> <span class="s2">&quot;MP3&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;VERSION&quot;</span><span class="p">,</span> <span class="s2">&quot;repertoire=&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;REPERTOIRE=&quot;</span> <span class="p">]</span> <span class="p">)</span>
    <span class="c1">#print(f&quot;debug param : {options},{remainder}\n&quot;)</span>

    <span class="k">for</span> <span class="n">opt</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;-H&quot;</span><span class="p">,</span> <span class="s2">&quot;--HELP&quot;</span><span class="p">]:</span>
        <span class="n">oncontinue</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="k">elif</span> <span class="n">opt</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;-M&quot;</span><span class="p">,</span> <span class="s2">&quot;--MP3&quot;</span><span class="p">]:</span>
        <span class="n">test_presenceficmp3</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="k">elif</span> <span class="n">opt</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;-R&quot;</span><span class="p">,</span> <span class="s2">&quot;--REPERTOIRE&quot;</span><span class="p">):</span>
        <span class="c1">#print(f&quot;debug {arg}&quot;)</span>
        <span class="n">oncontinue</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">repertoire_travail</span> <span class="o">=</span> <span class="n">arg</span>
      <span class="k">elif</span> <span class="n">opt</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;-V&quot;</span><span class="p">,</span> <span class="s2">&quot;--VERSION&quot;</span><span class="p">):</span>
        <span class="n">oncontinue</span> <span class="o">+=</span> <span class="mi">10</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">oncontinue</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">scom</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&gt;&gt;&gt;&gt;PARAMETRE(S): </span><span class="si">{</span><span class="n">opt</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2"> IMPREVU(S)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="c1">#print(f&quot;debug param : {opt.upper()},{arg}\n&quot;)</span>
    <span class="k">match</span> <span class="n">oncontinue</span><span class="p">:</span>
      <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#print(f&quot;debug chemin : {pathlib.PureWindowsPath(repertoire_travail)}&quot;)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">repertoire_travail</span><span class="p">):</span>
          <span class="n">scom</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&gt;&gt;&gt;&gt;REPERTOIRE: </span><span class="si">{</span><span class="n">repertoire_travail</span><span class="si">}</span><span class="s2"> INACESSIBLE.</span><span class="se">\n</span><span class="s2">&quot;</span>
          <span class="n">codeexit</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">scom</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&gt;&gt;&gt;&gt;REPERTOIRE CHOISI: </span><span class="si">{</span><span class="n">repertoire_travail</span><span class="si">}</span><span class="s2"> [OK]</span><span class="se">\n</span><span class="s2">&quot;</span>
          <span class="n">codeexit</span> <span class="o">=</span> <span class="mi">2</span>
      <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">scom</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&gt;&gt;&gt;&gt;DEMANDE AIDE:</span><span class="se">\n</span><span class="si">{</span><span class="n">USAGE</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">codeexit</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">case</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">scom</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&gt;&gt;&gt;&gt;DEMANDE VERSION:</span><span class="se">\n</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="k">case</span> <span class="mi">11</span><span class="p">:</span>
        <span class="n">scom</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&gt;&gt;&gt;&gt;DEMANDE AIDE + VERSION:</span><span class="se">\n</span><span class="si">{</span><span class="n">USAGE</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

  <span class="k">except</span> <span class="n">getopt</span><span class="o">.</span><span class="n">GetoptError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="n">scom</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&gt;&gt;&gt;&gt; ERREUR: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">scom</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">USAGE</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">codeexit</span> <span class="o">=</span> <span class="mi">1</span>

  <span class="k">return</span> <span class="p">(</span><span class="n">codeexit</span><span class="p">,</span> <span class="n">scom</span><span class="p">,</span> <span class="n">repertoire_travail</span><span class="p">,</span> <span class="n">test_presenceficmp3</span><span class="p">)</span></div>

<div class="viewcode-block" id="find"><a class="viewcode-back" href="../listem3u.html#listem3u.find">[docs]</a><span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trouve les fichiers selon pattern sous path</span>

<span class="sd">  [ EN ENTREE ]</span>
<span class="sd">      pattern (chaine) recherche de fichier</span>
<span class="sd">      path (chaine) repertoire</span>

<span class="sd">  [ EN SORTIE ]</span>
<span class="sd">      result (tableau de chaine) basename + fichier</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1">### parametre local</span>
  <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="c1"># pylint: disable=unused-variable</span>
  <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">basename</span><span class="p">)</span> <span class="k">for</span> \
      <span class="n">basename</span> <span class="ow">in</span> <span class="n">files</span> \
        <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">pattern</span><span class="p">))</span>
  <span class="c1">#print(f&quot;debug find {result}&quot;)</span>
  <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="action"><a class="viewcode-back" href="../listem3u.html#listem3u.action">[docs]</a><span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">repert</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fic_tampon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fic</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">testmp3</span><span class="o">=</span><span class="n">DEFAUT_FICMP3</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;_</span>
<span class="sd">    Gestion des parametres d&#39;appel = repertoire, help et version</span>

<span class="sd">  [ EN ENTREE ]</span>
<span class="sd">      repert (chaine) répertoire de travail</span>
<span class="sd">      fic_tampon (chaine) fichier de travail</span>
<span class="sd">      fic (chaine) fichier resultat</span>
<span class="sd">      testmp3 (boolean) DEFAUT_FICMP3</span>

<span class="sd">  [ EN SORTIE ]</span>
<span class="sd">      constitution du fichier de sortie dans le repertoire de travail</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1">### parametre local</span>
  <span class="n">fichiersmp3</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">ficfiltre</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">ssrep</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

  <span class="c1"># initial directory</span>
  <span class="c1">#cwd = os.getcwd()</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">repert</span><span class="p">)</span>
    <span class="c1"># menage fichiers si existants</span>
    <span class="k">if</span> <span class="n">file_exists</span><span class="p">(</span><span class="n">fic_tampon</span><span class="p">):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">fic_tampon</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_exists</span><span class="p">(</span><span class="n">fic</span><span class="p">):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">fic</span><span class="p">)</span>
  <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">NotADirectoryError</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Something wrong with specified</span><span class="se">\</span>
<span class="s2">          directory </span><span class="si">{</span><span class="n">repert</span><span class="si">}</span><span class="s2">. Exception- &quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

  <span class="c1"># trouve tous les fichiers de nom contenant -Playlist.m3u sous ./</span>
  <span class="n">ficm3u</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="s2">&quot;*-Playlist.m3u&quot;</span><span class="p">,</span> <span class="s1">&#39;./&#39;</span><span class="p">)</span>

  <span class="c1"># traite chaque fichier de nom contenant -Playlist.m3u sous repert</span>
  <span class="k">for</span> <span class="n">fichier</span> <span class="ow">in</span> <span class="n">ficm3u</span><span class="p">:</span>
    <span class="n">ssrep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fichier</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1">#print(f&quot;debug action : {ssrep}&quot;)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fichier</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">lefic</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">ligne</span> <span class="ow">in</span> <span class="n">lefic</span><span class="p">:</span>
        <span class="c1"># TODO: faire un filtre sur ligne contenant des blancs...</span>
        <span class="n">ficfiltre</span> <span class="o">=</span> <span class="n">filtreligne</span><span class="p">(</span><span class="n">ligne</span><span class="p">,</span> <span class="n">ssrep</span><span class="p">)</span>
        <span class="c1"># TODO: ajouter mention du ssrep...</span>
        <span class="n">miseenforme</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ficfiltre</span><span class="si">}</span><span class="s2"> # </span><span class="si">{</span><span class="n">ssrep</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">fichiersmp3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">miseenforme</span><span class="p">)</span>
    <span class="n">lefic</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  <span class="c1"># on classe selon ordre alphabetic des chaines considérées en minuscules</span>
  <span class="n">fichiersmp3</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>
  <span class="c1">#print(f&quot;debug {fichiersmp3}&quot;)</span>
  <span class="c1">#ecriture du resultat</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fic</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resultat</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">elmt</span> <span class="ow">in</span> <span class="n">fichiersmp3</span><span class="p">:</span>
      <span class="n">miseenforme</span> <span class="o">=</span> <span class="n">elmt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
      <span class="n">lefich</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">miseenforme</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">miseenforme</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="n">resultat</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lefich</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">testmp3</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">file_exists</span><span class="p">(</span><span class="n">lefich</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&gt;&gt;&gt;&gt; inexistant : </span><span class="si">{</span><span class="n">lefich</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">resultat</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="filtreligne"><a class="viewcode-back" href="../listem3u.html#listem3u.filtreligne">[docs]</a><span class="k">def</span> <span class="nf">filtreligne</span><span class="p">(</span><span class="n">unechaine</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ssrep</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filtre une ligne de fichier m3u, alerte si contient un espace, ou plus d&#39;un</span>
<span class="sd">    tiret et renvoie nom du fichier mp3</span>

<span class="sd">  [ EN ENTREE ]</span>
<span class="sd">      unechaine (chaine) une ligne du fichier m3u</span>
<span class="sd">      ssrep (chaine) un repertoire</span>

<span class="sd">  [ EN SORTIE ]</span>
<span class="sd">      unechaine (chaine)  nom du fichier mp3 retourné</span>
<span class="sd">                          suppression trailing-space.</span>
<span class="sd">                          alerte si contient un espace.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1">### parametre local</span>
  <span class="k">if</span> <span class="s1">&#39; &#39;</span> <span class="ow">in</span> <span class="n">unechaine</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&gt;&gt;&gt;&gt; au moins un espace : </span><span class="si">{</span><span class="n">ssrep</span><span class="si">}</span><span class="s2"> # </span><span class="si">{</span><span class="n">unechaine</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">unechaine</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&gt;&gt;&gt;&gt; plus d&#39;1 tiret : </span><span class="si">{</span><span class="n">ssrep</span><span class="si">}</span><span class="s2"> # </span><span class="si">{</span><span class="n">unechaine</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">tamp</span> <span class="o">=</span> <span class="n">unechaine</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tamp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">!=</span> <span class="n">tamp</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&gt;&gt;&gt;&gt; majuscules : </span><span class="si">{</span><span class="n">ssrep</span><span class="si">}</span><span class="s2"> # </span><span class="si">{</span><span class="n">unechaine</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">unechaine</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

<span class="c1">### Principal</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

  <span class="p">(</span><span class="n">CODE_RETOUR</span><span class="p">,</span> <span class="n">SCOM</span><span class="p">,</span> <span class="n">REP</span><span class="p">,</span> <span class="n">TEST_PRESENCEFICMP3</span><span class="p">)</span> <span class="o">=</span> <span class="n">parametres</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">CODE_RETOUR</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">SCOM</span><span class="p">)</span>
    <span class="n">action</span><span class="p">(</span><span class="n">REP</span><span class="p">,</span> <span class="n">FICS_LISTE_TAMPON</span><span class="p">,</span> <span class="n">FICS_LISTE</span><span class="p">,</span> <span class="n">TEST_PRESENCEFICMP3</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">SCOM</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Nicolas Bruschi 😀.
      <span class="lastupdated">Mis à jour le 01 avr. 2023 à 19:49.
      </span></p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!-- https://holzhaus.github.io/sphinx-multiversion/v0.2.3/templates.html -->


  <div class="rst-versions" data-toggle="rst-versions" role="note" 
       aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: 1-sans-fichier-mp3
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl>
        <dt>Languages</dt>
        
          
          <dd><a href="//fr/1-sans-fichier-mp3/">fr</a></dd>
          
        
      </dl>
      
      
      <dl>
        <dt>Versions</dt>
        
           <strong> 
          <dd><a href="//fr/1-sans-fichier-mp3/">1-sans-fichier-mp3</a></dd>
           </strong> 
        
          
          <dd><a href="//fr/main/">main</a></dd>
          
        
      </dl>
      
      
      <dl>
        <dt>Téléchargements</dt>
        
          <dd><a href="//fr/1-sans-fichier-mp3/listem3u-docs_fr_1-sans-fichier-mp3.pdf">pdf</a></dd>
        
          <dd><a href="//fr/1-sans-fichier-mp3/listem3u-docs_fr_1-sans-fichier-mp3.epub">epub</a></dd>
        
      </dl>
      
      
      <hr/>
      <a href="https://tech.michaelaltfield.net/2020/07/18/
sphinx-rtd-github-pages-1/">Continuous Documentation</a> 
hosting provided by <a href="https://pages.github.com/">
GitHub Pages</a>.
 
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>